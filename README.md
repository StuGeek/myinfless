# INFless- for latest openfaas

项目将基于旧版OpenFaas的INFless-代码向最新版OpenFaas做了代码移植
 
## Contents

- sourceCode: The source code of INFless for implementation and evaluation.
- configuration: The cluster configuration file that needs to be loaded when INFless launches.
- developer: The inference functions that could be deployed into INFless.
- models: The metadata of inference models evaluated in INFless.
- profiler: The model performance-resource profiles.
- workload: The function workload trace used for evaluation
- scripts: Some scripts used in the evaluation.

## INFless Installation

Deployment guide of INFless for Kubernetes is available [here](https://github.com/hongzicong/INFless-/tree/main/scripts).

> Notice: INFless is fully implemented with OpenFaaS, which is a serverless frameworks built with Kubernetes. The installation of INFless is similar as OpenFaaS, and **we strongly recommend you have some preliminary knowledges about OpenFaaS and understand how it works with Kubernetes**. The deployment guide of OpenFaaS for Kubernetes is available here: https://docs.openfaas.com/deployment/kubernetes/.

## Inference Function Deployment

Guidance for function developer is available [here](https://github.com/hongzicong/INFless-/tree/main/developer).

Notice: Once INFless is deployed successfully, developers could use faasdev-cli tools to upload their inference functions and build them as FaaS service. 

## Load Generator Installation
Guidance to install `LoadGen` tool is available [here](https://github.com/TankLabTJU/INFless/tree/main/sourceCode/Java/LoadGen).

> Notice: Be sure that the deployed inference functions and workload generator work well before evaluating INFless platform.

## Result

```bash
ubuntu@k8s-master:~/myinfless/developer/servingFunctions$ faasdev-cli deploy -f mobilenet.yml
Deploying: mobilenet.
WARNING! Communication is not secure, please consider using HTTPS. Letsencrypt.org offers free SSL/TLS certificates.

Deployed. 202 Accepted.
URL: http://127.0.0.1:31212/function/mobilenet

ubuntu@k8s-master:~/myinfless/developer/servingFunctions$ cat ../test/test.py 
import requests
import numpy as np

predict_request='{"signature_name": "serving_default", "instances":[{"inputs":%s}] }' %np.random.rand(224,224,3).tolist()
# print(predict_request)

response = requests.post(url="http://192.168.230.128:31212/function/mobilenet", data=predict_request)

response.raise_for_status()
print(response.text)
print(response.elapsed.total_seconds() * 1000)

ubuntu@k8s-master:~/myinfless/developer/servingFunctions$ python ../test/test.py 
{
    "predictions": [[4.98931377e-06, 5.64089078e-06, 3.24267712e-05, 0.000283098227, 7.89585247e-05, 0.00285428553, 7.75058725e-05, 0.000134161659, 1.10226729e-05, 2.60332145e-05, 9.57119046e-05, 6.28900234e-05, 6.44308602e-05, 6.43142776e-05, 0.000171720036, 0.00154459046, 0.000127906416, 0.000280325534, 7.30052707e-05, 0.000625210872, 0.000117612632, 3.75615491e-05, 0.00107093505, 0.000234582214, 0.000634033757, 0.0013165893, 9.03847922e-06, 3.62991232e-05, 5.21433758e-05, 1.35368537e-05, 7.42807169e-05, 6.34362732e-06, 1.22109168e-05, 1.29158598e-05, 5.78880135e-05, 0.000124006023, 3.08440121e-06, 0.000313240307, 5.96782593e-05, 0.000110858469, 9.6414069e-06, 0.000219545, 0.000133350375, 3.31739757e-05, 4.47672101e-05, 0.000137618277, 7.88019825e-05, 8.86992057e-05, 8.71023531e-06, 1.99635761e-05, 1.57831673e-05, 0.00158378191, 9.53873769e-06, 0.000131054549, 0.000121096811, 0.000278590684, 2.81734592e-05, 8.70280855e-05, 0.000881923188, 0.000729668536, 0.0027421033, 0.000445786078, 9.62756894e-06, 0.000245048665, 3.3765682e-05, 3.11763433e-05, 7.0568356e-05, 0.000184035714, 0.000244841911, 0.000104562561, 0.00184143696, 0.000109270368, 0.000979065546, 6.84993574e-05, 0.00252998, 0.00049410871, 0.000513418, 2.51242291e-05, 7.32973713e-05, 0.0286093783, 0.000590571493, 0.000763775723, 7.77037712e-05, 0.000257763139, 0.000752829656, 1.8851304e-05, 0.000401782774, 0.000495317858, 0.000166907907, 8.23361333e-05, 0.000179153329, 5.05102289e-05, 0.000137644922, 0.00234128418, 0.000154925598, 0.000449948537, 1.79468479e-05, 0.000664680963, 4.6911071e-05, 0.00013475318, 0.000457308022, 6.06577887e-05, 0.000115787559, 4.96543071e-05, 0.000547080243, 1.65941783e-05, 4.39019868e-06, 2.76865085e-05, 0.00373917469, 5.17399094e-05, 6.36898694e-05, 4.1986179e-05, 0.31205827, 8.75487749e-05, 0.000217508088, 0.000502290553, 4.67146128e-06, 5.58082465e-05, 3.52908901e-05, 4.08313326e-06, 3.04690184e-05, 0.000561185181, 7.44523447e-07, 1.03715502e-06, 3.87202044e-06, 9.09377e-06, 4.48915343e-05, 0.00219368679, 0.000154133624, 0.000249963545, 0.00037743189, 9.12994146e-05, 0.000128278145, 0.000362127845, 0.000337316305, 0.000347439054, 0.000135314724, 6.65988637e-06, 0.000293641526, 0.000328733091, 2.55726227e-05, 7.99368208e-05, 4.74342269e-05, 7.31789769e-05, 1.31058368e-05, 2.01824751e-05, 6.2762876e-05, 0.000125530365, 0.000211205552, 0.000679418561, 1.61479966e-05, 5.44960603e-05, 0.000374387571, 9.98053565e-06, 0.000122536541, 2.91194428e-05, 0.000189674669, 4.83822623e-06, 4.39296455e-05, 1.09778048e-05, 2.17290071e-05, 3.11483018e-06, 7.41977346e-05, 0.000113364738, 7.1146249e-05, 0.000339589431, 3.30479361e-06, 6.19317416e-06, 7.25684777e-06, 9.90048284e-05, 6.91532e-06, 7.6912138e-06, 4.91355713e-05, 7.52191263e-05, 0.000238702793, 1.39947851e-05, 1.66779337e-05, 2.24069627e-05, 4.32217212e-06, 0.000218195681, 1.56023543e-05, 3.94592735e-06, 0.000218055968, 0.000129646607, 1.07303676e-05, 3.49694346e-05, 4.75512388e-06, 4.16200646e-06, 0.000604198955, 1.83353186e-05, 2.80681161e-05, 4.14258102e-05, 0.000100914011, 1.09628963e-05, 2.51006386e-05, 1.80084153e-05, 0.000136172283, 1.35244145e-05, 2.97525912e-05, 1.13195292e-05, 4.95927343e-05, 6.14682212e-05, 8.19997604e-06, 0.000197493777, 0.00011677474, 1.61239604e-05, 7.68929294e-06, 3.57551071e-05, 6.34363678e-05, 1.87639016e-05, 5.60665467e-05, 2.44661587e-05, 7.56074878e-05, 2.4169638e-05, 2.12381092e-05, 1.17933014e-05, 2.58527034e-05, 6.65271073e-05, 2.44768707e-05, 1.56170172e-05, 8.0849286e-06, 5.27413476e-06, 2.14271276e-05, 8.36771324e-06, 2.548884e-05, 8.56573115e-06, 5.98843826e-06, 2.07865085e-07, 8.15574822e-06, 2.95510949e-06, 6.9824142e-05, 1.21975208e-05, 3.5175824e-06, 4.64506911e-06, 3.84786154e-06, 6.53083916e-05, 1.33136327e-05, 6.51988084e-05, 3.0010804e-05, 1.48173303e-05, 1.20275663e-05, 0.000159107658, 2.83995178e-05, 1.39752992e-05, 5.68623364e-06, 2.17215274e-05, 6.37829944e-05, 1.09140865e-05, 1.21576049e-05, 5.89854644e-05, 8.63364185e-05, 1.50529368e-05, 4.89947743e-05, 4.15486e-06, 1.76725e-05, 2.23413899e-05, 1.52282769e-06, 2.24388759e-06, 1.43892032e-06, 1.34281017e-05, 2.39708261e-05, 2.36688493e-06, 2.99960684e-05, 1.36978781e-06, 4.98683803e-05, 5.05149774e-06, 0.000187593745, 5.72494537e-05, 8.37718289e-06, 5.58342481e-06, 4.23938627e-06, 3.06522234e-05, 1.2944246e-05, 0.000106105457, 5.91512508e-05, 1.80336519e-06, 1.81068335e-05, 2.4636307e-05, 0.000138352043, 3.11441618e-05, 3.81344689e-05, 5.56658415e-05, 3.88975459e-05, 2.05831293e-05, 1.69687064e-05, 0.000286055321, 6.56111079e-05, 5.54752187e-05, 0.000112895315, 1.65636648e-05, 2.48063725e-06, 4.12528379e-06, 2.58711771e-05, 3.94943618e-06, 1.46263628e-05, 2.61310925e-05, 0.000164398603, 8.00910348e-05, 1.28819574e-05, 0.000338211627, 0.000158970244, 0.000233025421, 0.00298648817, 0.000748495688, 0.00121458434, 0.00113466906, 0.000228052391, 0.000100229394, 0.00410120655, 0.0021466685, 0.000493696076, 0.00197988516, 0.00021944652, 0.000139825715, 4.13124253e-05, 0.00093250582, 0.00167989486, 0.00020514433, 0.00529962, 0.00411280198, 0.00652754, 0.00225955201, 5.25263567e-06, 1.30334565e-05, 4.8840684e-05, 0.00021307217, 9.6044e-05, 0.000139806114, 0.00112624804, 9.5038471e-05, 5.66634e-06, 9.33674164e-05, 0.000205143748, 2.19705344e-05, 8.50109063e-06, 9.82308047e-05, 1.74758079e-05, 4.02081751e-05, 0.00018736285, 1.40429947e-05, 6.88705859e-06, 2.40564968e-05, 3.3969211e-06, 1.86558973e-05, 6.85900523e-06, 5.16569571e-06, 1.68582646e-05, 5.43068527e-05, 6.45949476e-05, 6.89145818e-05, 0.000130642322, 7.83793439e-05, 0.000136673116, 3.74893466e-06, 7.14365597e-05, 3.89190682e-05, 2.46489844e-06, 0.000931532064, 1.44229807e-05, 5.15217362e-05, 0.000219233465, 1.82025942e-05, 0.000275223312, 5.25259857e-05, 7.58079186e-05, 6.63765313e-05, 3.55352495e-06, 3.44973682e-06, 2.98263694e-05, 9.24328651e-06, 1.34563879e-06, 1.07987189e-05, 7.62513355e-06, 3.45382723e-05, 1.68640122e-06, 0.000109102308, 4.53673056e-06, 4.40060649e-06, 0.000166502738, 6.2544932e-06, 9.07598314e-06, 3.2960168e-05, 2.06717905e-05, 2.17321594e-05, 5.34660758e-05, 6.31101284e-06, 1.27735202e-05, 2.12824507e-05, 3.91705771e-06, 1.45798549e-06, 4.11086876e-05, 2.53142061e-05, 0.000151123721, 1.42010122e-05, 1.02379836e-05, 5.87745562e-05, 0.000314998149, 1.50524056e-05, 4.23478159e-05, 0.00010493517, 0.00104908703, 4.24109858e-05, 4.48299324e-05, 0.000345456501, 0.000180441639, 0.000529298501, 0.00102653785, 3.71810393e-06, 2.3737739e-05, 1.29470538e-06, 0.00038685606, 8.05995478e-06, 0.0199801382, 6.45546679e-05, 0.00108923961, 0.000186340796, 1.70918065e-06, 0.000198004927, 0.00143767498, 0.00437393179, 0.000918804, 0.000347629, 5.5616867e-05, 1.91362851e-05, 3.51325943e-05, 4.54175643e-06, 9.83662685e-05, 0.000130663437, 6.0884654e-06, 5.05232347e-05, 4.48517821e-05, 8.88971117e-05, 0.000350524235, 0.000212464656, 0.000318534294, 0.000233877799, 9.61757178e-05, 1.55934431e-05, 0.00136976375, 0.000277922081, 1.94960612e-05, 3.84256091e-05, 0.000103380349, 0.000128978645, 0.0133428117, 1.5718173e-05, 3.83240113e-05, 0.02237585, 6.79556542e-05, 4.34191788e-05, 3.20225172e-06, 2.80443442e-06, 0.000771236082, 0.000214556741, 4.22036601e-06, 5.75310742e-06, 0.00174331781, 6.00408712e-05, 0.000172664193, 0.00115324, 0.000389374647, 0.00030470168, 0.000938827463, 0.000641517632, 0.000497353729, 0.000394432136, 0.000207800273, 1.48028385e-05, 9.47676654e-07, 4.63352335e-05, 0.000182040545, 0.00244924845, 2.01960684e-05, 0.000506232958, 0.00145353877, 0.000166721526, 0.000372065289, 1.16711672e-05, 2.84106791e-05, 0.000502062554, 1.94215172e-05, 0.000158055205, 1.37707229e-05, 2.23273128e-05, 6.39609207e-05, 0.000314193952, 0.00116888, 1.11195013e-05, 0.000569397234, 0.00140637706, 8.88568538e-05, 0.00117736927, 0.000521673763, 0.00016727217, 2.71098e-06, 0.000646626519, 1.07296978e-06, 2.40419577e-05, 0.000136583083, 3.03722081e-05, 0.000646072731, 0.000180751827, 0.000208410158, 5.44770137e-06, 0.000198224749, 5.58958636e-05, 1.40785442e-05, 3.16021069e-05, 0.000133685011, 0.0001163739, 3.76413891e-06, 1.72521723e-05, 4.16292532e-05, 0.00668526487, 0.000405055092, 0.000203067058, 5.80245905e-05, 2.21701084e-05, 0.000123955368, 8.82706536e-06, 1.2225657e-05, 0.000557555584, 1.41725723e-05, 2.13881522e-05, 4.95709828e-05, 0.000165935402, 2.27831861e-05, 0.000151485321, 2.92392706e-05, 4.60221827e-06, 2.81154298e-05, 0.00070990267, 0.00248354673, 2.84686507e-06, 0.000257980893, 0.000763862045, 8.28620102e-07, 2.10006783e-06, 4.06084509e-05, 0.000784083852, 0.000259712222, 0.000204383337, 0.000462159282, 0.000138245086, 6.41345105e-05, 2.25482472e-05, 0.000135752241, 0.000156662805, 1.2141378e-06, 5.36210746e-06, 0.0289303623, 1.18014359e-05, 0.000668633846, 0.00119261921, 4.19439966e-05, 0.00018448451, 3.1796033e-05, 0.00159848633, 0.000287333503, 0.000332441123, 9.98559626e-05, 1.79804247e-05, 1.88331014e-05, 0.000641486491, 0.00435430184, 2.16820808e-05, 0.000111548019, 3.18776765e-05, 7.67236852e-05, 2.39418569e-05, 1.26911266e-06, 2.19475387e-05, 0.000103252845, 0.000586618087, 1.22176261e-05, 0.00213582115, 1.18514e-05, 6.89860535e-05, 0.000114672766, 0.000116464274, 7.20681192e-06, 2.93058783e-05, 0.000573039462, 5.87804379e-07, 1.15703169e-05, 0.00900113489, 4.56157e-05, 1.44336718e-05, 0.000165791367, 9.68364329e-05, 2.75936964e-05, 3.13176242e-05, 0.00128389639, 2.59214085e-05, 0.00153518957, 0.000111647263, 1.95546254e-05, 0.000695532188, 0.000115868534, 0.000273742509, 0.000527196273, 0.00803897902, 0.000107363208, 5.61265188e-05, 4.91286812e-07, 0.000945736072, 0.000517415465, 0.0003714661, 0.000179155628, 0.00337951141, 3.39739563e-05, 0.0231828485, 0.00271562, 7.8455625e-05, 0.000211335719, 6.69221408e-05, 0.000231254555, 0.00278672529, 3.43554238e-05, 0.00987040065, 0.00467955694, 0.00236027944, 6.76540658e-05, 0.000690867251, 0.00614788895, 1.34144636e-06, 2.00784234e-05, 0.00236636936, 1.09446464e-05, 0.000178030503, 0.00242589624, 5.53761056e-05, 0.000332329073, 0.000752668129, 0.000562354689, 1.50296489e-06, 0.000100260462, 0.00117584097, 1.61099269e-05, 0.000184385761, 0.000107285072, 0.00230224617, 0.000122539626, 1.33074e-05, 0.000328455935, 0.00665316777, 6.41810111e-05, 4.71303538e-05, 0.00138690043, 8.91773198e-07, 0.000595405523, 0.00101957598, 0.000302706409, 2.96771832e-05, 9.86931173e-06, 3.271791e-06, 0.00026174754, 3.25901692e-06, 0.000653532217, 2.76258083e-06, 0.000153648056, 9.3274457e-06, 8.10756683e-06, 0.000305804104, 1.24554726e-05, 0.000781849, 4.53890061e-05, 5.05994467e-06, 4.81504758e-05, 6.05297901e-05, 0.000520738307, 5.98967526e-05, 5.46541514e-06, 2.54663901e-05, 0.000183875381, 9.5743766e-05, 4.15553768e-06, 1.64416469e-05, 0.0127182323, 0.000181115916, 0.00401406316, 0.00100887415, 0.00285957125, 0.00126699894, 0.000419563, 0.000138879899, 4.83153344e-05, 3.59387523e-05, 2.09865038e-06, 8.73090685e-05, 3.68475521e-05, 4.55569e-06, 9.9318604e-05, 6.71669e-05, 0.00131674507, 4.83625581e-06, 0.000404510589, 0.00449059717, 0.000415519491, 9.05815739e-07, 9.1074442e-05, 0.00107937772, 0.00472243875, 4.158101e-05, 1.63340901e-05, 9.64683786e-05, 5.71384817e-06, 1.13039027e-06, 2.95045743e-06, 2.84132529e-05, 8.31048892e-05, 7.7654e-05, 8.77734929e-05, 0.00102526892, 6.41745864e-05, 0.0209321268, 5.60099e-05, 5.18931e-05, 4.77472258e-06, 1.97285081e-05, 4.18124e-05, 0.000354129355, 0.00266511622, 9.373598e-05, 0.000318178732, 0.000558973348, 0.000207494144, 8.36121944e-06, 0.000508011726, 0.000295808451, 0.000350130169, 1.30115495e-05, 0.000458892784, 1.26946434e-05, 0.00215846719, 1.04516789e-06, 0.00407965621, 0.000408937281, 0.0018551416, 1.53855035e-05, 9.10446124e-06, 0.000567055366, 0.00196180027, 7.65935474e-05, 2.39701137e-07, 0.00143028679, 1.03855609e-05, 0.000323784567, 1.30109283e-05, 0.000231871571, 0.0038231113, 0.00359973451, 2.05974065e-05, 4.818249e-05, 4.2783322e-06, 0.000295470381, 0.000326278, 8.55529743e-06, 1.74945e-05, 2.4684683e-05, 2.16127555e-05, 0.00286876247, 0.00159109104, 4.12948384e-06, 0.000919694838, 0.00262560695, 5.6327066e-05, 5.92201923e-06, 0.000780985283, 9.32911826e-06, 0.00305847265, 5.26276199e-05, 0.000391892041, 0.00486076344, 0.000278454, 3.97081421e-05, 0.00152531557, 0.000184372038, 0.000624726235, 6.33898599e-05, 2.37918593e-05, 0.000184001416, 0.000394610834, 0.00192551489, 0.0238892864, 0.00864883047, 2.85925744e-05, 3.7992424e-05, 1.09233533e-05, 2.87214448e-06, 0.000160378331, 2.13807507e-05, 0.000594952551, 0.000196533292, 0.00118304475, 0.009369, 0.000191900152, 0.000248749449, 0.00125072757, 0.000262376096, 4.41728662e-06, 7.76318939e-06, 4.46348022e-05, 5.65957052e-05, 3.56842679e-06, 0.0015280199, 5.77945684e-05, 5.55716433e-05, 3.8854e-06, 0.000647143519, 2.37373533e-05, 2.8163975e-05, 0.00222121389, 0.00176861591, 0.0149738537, 0.000128501604, 0.00153756456, 0.000133920446, 2.85694205e-06, 0.000167401435, 0.000108790664, 7.43950295e-06, 0.000140067888, 1.69216964e-05, 9.22794788e-05, 0.000177060298, 8.10232632e-06, 0.000244323397, 0.000174320216, 0.0111327991, 3.44481214e-06, 2.68151416e-05, 0.000320862862, 1.83696775e-05, 0.000860022847, 4.86168319e-05, 9.21622814e-06, 4.04690036e-05, 3.81866557e-05, 0.000197904214, 7.20828257e-06, 9.86539308e-05, 0.00503619434, 0.000199487215, 2.82146775e-05, 0.0161670055, 0.00124635349, 2.52753434e-05, 1.18116031e-05, 9.78507796e-06, 0.000100979865, 1.40216371e-05, 0.000275547791, 0.00283149257, 8.56785482e-06, 3.32605523e-05, 0.000260336645, 7.14221187e-07, 2.7354663e-05, 6.62911916e-05, 8.98924409e-05, 2.37101244e-06, 0.00026702258, 8.31225698e-05, 8.37947227e-05, 2.28127215e-06, 1.42899626e-06, 6.07779111e-06, 1.49923499e-05, 0.00504572503, 8.98489889e-05, 0.000182143078, 0.000146039369, 0.00041911687, 1.99670012e-05, 2.49000522e-07, 0.000620926963, 0.000666613341, 1.21833255e-05, 1.54019358e-06, 0.0002976674, 1.3173365e-05, 8.11273367e-06, 7.63493153e-05, 5.76250604e-05, 3.02517083e-06, 0.00475045806, 0.000227975848, 0.000164270255, 7.75147055e-06, 1.79038034e-05, 2.23510119e-06, 3.97185177e-05, 0.000739769428, 0.000532539212, 4.79750597e-05, 0.00063051749, 6.47797642e-05, 1.64869925e-05, 0.0023456153, 0.000500045135, 0.00044257415, 1.54173013e-05, 0.00327698933, 2.63576767e-05, 0.00218844204, 1.27541653e-05, 0.00018791022, 7.16381e-05, 0.00464109518, 6.60187288e-06, 0.000965294486, 0.00281238905, 2.53728867e-05, 0.000145763246, 2.1987742e-05, 1.12490306e-05, 0.000258436194, 1.58987439e-06, 0.000491844956, 6.37469348e-05, 0.00021913636, 7.81950075e-05, 0.000291071163, 2.40547779e-05, 2.64115988e-05, 1.86017987e-05, 2.3378534e-06, 1.17730349e-06, 4.82587575e-06, 0.000178954142, 3.14418758e-05, 1.25996985e-05, 1.6466849e-05, 9.36032666e-06, 5.33948878e-05, 5.89495539e-06, 9.97143652e-05, 1.23151058e-05, 0.00121146487, 4.70160785e-06, 0.000171688589, 2.6526277e-05, 2.67844325e-06, 1.64521716e-05, 4.1308067e-06, 3.1317235e-05, 1.72950531e-05, 1.25599872e-05, 0.000526741671, 4.45903861e-05, 0.00234214938, 0.0251646582, 9.94888542e-05, 3.89505185e-05, 0.00195363862, 2.0817437e-05, 9.01315525e-06, 0.000128249871, 0.00016523237, 4.09078029e-06, 4.95472341e-06, 9.2644892e-05, 8.61571834e-07, 3.84315827e-05, 1.18102071e-05, 1.00765956e-05, 0.000193043801, 1.70341937e-05, 3.74594529e-05, 2.43001523e-05, 7.60574621e-05, 0.0118653346, 6.40698345e-05, 7.89562e-05, 0.000180123156, 0.000135323557, 0.00016479638, 0.00654446939, 0.000109415836, 1.29609216e-05, 0.000279708125, 3.01179807e-05, 1.04943929e-05, 3.06095717e-05, 3.5537505e-05, 0.00027923903, 1.18279704e-05, 8.54867103e-05, 2.67162541e-05, 3.88871958e-05, 1.76919439e-05, 5.30402576e-06, 3.68515384e-06, 3.89418028e-06, 1.81434789e-05, 3.87439395e-05, 2.95346808e-07, 1.02826073e-06, 1.49778589e-05, 0.000197334768]
    ]
}
5379.05
ubuntu@k8s-master:~/myinfless/developer/servingFunctions$ 
```